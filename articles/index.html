<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <title>Raksti – Ceribas3</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { color: #ff7b00; }
    .article-list a, .back { display: block; padding: 10px; margin: 10px 0; background: #fff; border: 1px solid #ddd; border-radius: 5px; text-decoration: none; color: #333; }
    textarea, input { width: 100%; padding: 10px; margin: 10px 0; }
    button { padding: 10px 20px; background: #ff7b00; border: none; color: white; border-radius: 5px; cursor: pointer; }
    .hidden { display: none; }
  </style>
</head>
<body>

  <div id="main-view">
    <h1>Raksti</h1>
    <a href="/articles?p=create">+ Izveidot jaunu rakstu</a>
    <div id="article-list"></div>
  </div>

  <div id="article-view" class="hidden">
    <h1 id="article-title"></h1>
    <p id="article-content"></p>
    <a class="back" href="/articles">← Atpakaļ uz rakstiem</a>
  </div>

  <div id="create-view" class="hidden">
    <h1>Izveidot rakstu</h1>
    <input type="text" id="new-title" placeholder="Raksta nosaukums">
    <textarea id="new-content" rows="6" placeholder="Raksta saturs..."></textarea>
    <button onclick="saveArticle()">Saglabāt</button>
    <a class="back" href="/articles">← Atcelt</a>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const view = params.get("p");
    const main = document.getElementById("main-view");
    const viewArticle = document.getElementById("article-view");
    const createView = document.getElementById("create-view");

    const articles = JSON.parse(localStorage.getItem("articles") || "{}");

    function saveArticle() {
      const titleInput = document.getElementById("new-title");
      const contentInput = document.getElementById("new-content");

      const title = titleInput.value.trim();
      const content = contentInput.value.trim();
      const id = title.toLowerCase().replace(/\s+/g, "-");

      if (!title || !content) {
        alert("Lūdzu, aizpildi visus laukus!");
        return;
      }

      articles[id] = { title, content };
      localStorage.setItem("articles", JSON.stringify(articles));
      window.location.href = `/articles?p=${id}`;
    }

    function renderList() {
      const container = document.getElementById("article-list");
      container.innerHTML = "";
      for (const id in articles) {
        const a = document.createElement("a");
        a.href = `/articles?p=${id}`;
        a.textContent = articles[id].title;
        container.appendChild(a);
      }
    }

    function renderArticle(id) {
      const article = articles[id];
      if (!article) {
        document.body.innerHTML = "<h1>Raksts nav atrasts</h1><a class='back' href='/articles'>← Atpakaļ</a>";
        return;
      }
      document.getElementById("article-title").textContent = article.title;
      document.getElementById("article-content").textContent = article.content;
    }

    if (!view) {
      renderList();
    } else if (view === "create") {
      main.classList.add("hidden");
      createView.classList.remove("hidden");
    } else {
      main.classList.add("hidden");
      viewArticle.classList.remove("hidden");
      renderArticle(view);
    }
  </script>

</body>
</html>
